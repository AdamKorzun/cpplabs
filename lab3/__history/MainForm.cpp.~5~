//---------------------------------------------------------------------------

#include <vcl.h>
#include <exception>
#include <iostream>
#pragma hdrstop
#include "Bus.cpp"
#include "MainForm.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm3 *Form3;
Bus* firstBus = new Bus();
Bus* head = firstBus;
//---------------------------------------------------------------------------
__fastcall TForm3::TForm3(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------

//---------------------------------------------------------------------------

//---------------------------------------------------------------------------
void __fastcall TForm3::EnterPress(TObject *Sender, System::WideChar &Key)
{
	if (Key != VK_RETURN) {
		return;
	}
	Form3->Memo1->Clear();
	try{
		StrToInt(Form3->BusCombo->Text);
	}
	catch(...){
		Form3->Memo1->Lines->Add("Error occured");
		return;
	}

	Bus* iteration = firstBus;
	while(iteration->next){
		if (iteration->GetNumber() == StrToInt(Form3->BusCombo->Text)) {
			return;
		}
		iteration = iteration->next;
	}
	Form3->BusCombo->Items->Add(Form3->BusCombo->Text);
	head->next = new Bus();




	head->SetNumber(StrToInt(Form3->BusCombo->Text));

	head->SetType(Form3->TypeMemo->Lines->Strings[0]);
	head->SetDestination(Form3->DestMemo->Lines->Strings[0]);
	head->SetDepartureTime(StrToInt(Form3->DepartureComboHours->Text) * 60 + StrToInt(Form3->DepartureComboMin->Text));
	head->SetArrivalTime(StrToInt(Form3->ArrivalComboHours->Text) * 60 + StrToInt(Form3->ArrivalComboMin->Text));
	//Form3->Memo1->Lines->Add(head->GetNumber());
	head = head->next;
	head->next = nullptr;


}
//---------------------------------------------------------------------------
void __fastcall TForm3::SaveButtonClick(TObject *Sender)
{
	Bus* iteration = firstBus;
	while(iteration->next){
		if (iteration->GetNumber() == StrToInt(Form3->BusCombo->Text)) {

			iteration->SetNumber(StrToInt(Form3->BusCombo->Text));
			iteration->SetType(Form3->TypeMemo->Lines->Strings[0]);
			iteration->SetDestination(Form3->DestMemo->Lines->Strings[0]);
			iteration->SetDepartureTime(StrToInt(Form3->DepartureComboHours->Text) * 60 + StrToInt(Form3->DepartureComboMin->Text));
			iteration->SetArrivalTime(StrToInt(Form3->ArrivalComboHours->Text) * 60 + StrToInt(Form3->ArrivalComboMin->Text));
			return;
		}
		iteration = iteration->next;
	}
}
//---------------------------------------------------------------------------
void __fastcall TForm3::ShowButtonClick(TObject *Sender)
{
	Bus* iteration = firstBus;
	Form3->Memo1->Clear();
	if (Form3->BusCombo->Text == "All") {
		while(iteration->next){
			Form3->Memo1->Lines->Add(IntToStr(iteration->GetNumber()));
			Form3->Memo1->Lines->Add(iteration->GetType());
			Form3->Memo1->Lines->Add(iteration->GetDestination());
			Form3->Memo1->Lines->Add(IntToStr(iteration->GetDepartureTime()));
			Form3->Memo1->Lines->Add(IntToStr(iteration->GetArrivalTime()));
			Form3->Memo1->Lines->Add("");
			iteration = iteration->next;
		}
		return;
	}

	while(iteration->next){
		if (iteration->GetNumber() == StrToInt(Form3->BusCombo->Text)) {

			Form3->Memo1->Lines->Add(IntToStr(iteration->GetNumber()));
			Form3->Memo1->Lines->Add(iteration->GetType());
			Form3->Memo1->Lines->Add(iteration->GetDestination());
			Form3->Memo1->Lines->Add(IntToStr(iteration->GetDepartureTime()));
			Form3->Memo1->Lines->Add(IntToStr(iteration->GetArrivalTime()));

			return;
		}
		iteration = iteration->next;
	}
}
//---------------------------------------------------------------------------
void __fastcall TForm3::CreateForm(TObject *Sender)
{
	Form3->TypeMemo->Clear();
	Form3->DestMemo->Clear();
	Form3->DestinationMemo->Clear();
	Form3->BusCombo->Items->Add("All");
}

//---------------------------------------------------------------------------
